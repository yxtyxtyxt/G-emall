<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" type="text/css" href="css/common.css"/>
		<link rel="stylesheet" type="text/css" href="css/footer.css"/>
		<link rel="stylesheet" type="text/css" href="css/head.css"/>
		<link rel="stylesheet" type="text/css" href="css/shopCar.css"/>
		<link rel="icon" href="http://www.g-emall.com/favicon.ico" type="mage/x-icon">
		<title>我的购物车</title>
		<script src="js/jquery-1.8.3.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/shopping/js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/cookie.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/shopCar.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$(function(){
				//获取cookie,判断是否用户已登录;
				var users = getCookie("loginedUsers");
				if(users){
					$('.head_login_register').find('.missu').eq(0).siblings().remove();
					$('<span class="missu" style="color: #111;font-size: 14px;">用户' + users + '&nbsp;</span><a href="javascript:;" id="fk_off">退出</a>').appendTo($('.head_login_register'));
				}
				//点击退出时候，删除cookie;并恢复界面
				$('#fk_off').click(function(){
					removeCookie("loginedUsers");
					$('.head_login_register').find('.missu').eq(0).siblings().remove();
					$('<a href="login.html">请登录&nbsp;</a><a href="register.html" style="color: #c20005;">注册</a>').appendTo($('.head_login_register'));
				})
			})
		</script>
	</head>
	<body>
		<!--头部Start-->
		<div class="head-wrap">
			<div class="head">
				<a href="index.html" class="gx_home">盖象首页</a>
				<div class="head_login_register">
					<span class="missu">
						想你了，欢迎来到盖象! &nbsp;&nbsp;
					</span>
					<a href="login.html">请登录&nbsp;</a>
					<a href="register.html" style="color: #c20005;">注册</a>
				</div>
				<div class="gx_head">
				<a href="" class="head_shopcar" title="购物车">
					购物车
					<span class="head_shocar_num">0</span>
				</a>
				<div class="my_gx">
					<a href="">我的盖象</a>
					<span></span>
					<div class="my_gx_menu">
						<a href="#">我的订单</a><br />
						<a href="#">我的钱包</a>
					</div>
				</div>
				<div class="my_gx">
					<a href="">收藏夹</a>
					<span></span>
					<div class="my_gx_menu">
						<a href="#">收藏的商品</a><br />
						<a href="#">收藏的店铺</a>
					</div>
				</div>
				<div class="my_gx">
					<a href="">商家支持</a>
					<span></span>
					<div class="my_gx_menu">
						<a href="#">商家入驻</a><br />
						<a href="#">合作加盟</a><br />
						<a href="#">盖网终端机</a>
					</div>
				</div>
				<a href="#" class="cellapp">手机APP</a>
				<div class="head_language">
					<select class="">
						<option value="简体中文" selected="selected">简体中文</option>
						<option value="繁体中文">繁体中文</option>
					</select>
				</div>
				
			</div>
			</div>
			<script type="text/javascript">
				$('.my_gx').mouseover(function(){
					$(this).addClass('my_gx_hover').find('.my_gx_menu').css('display','block');
				}).mouseout(function(){
					$(this).removeClass('my_gx_hover').find('.my_gx_menu').css('display','none');
				})
				
			</script>
		</div>
		<!--头部end-->
		<!--Logo&搜索栏Start-->
		<div class="logoSearch_wrap">	
			<div class="logoSearch">
				<a href="index.html" class="logo"><img src="img/top_logo.png" title="盖象商城"/></a>
				<span class="gouWuChe_word">购物车</span>
				<div class="shop_jinD">
					<div class="shop_jinD1">
						查看购物车
					</div>
					<span class="heng-"></span>
					<div class="shop_jinD2">
						确认订单
					</div>
					<span class="heng-" style="left:157px;"></span>
					<div class="shop_jinD2">
						支付
					</div>
					<span class="heng-" style="left: 257px;"></span>
					<div class="shop_jinD2">
						确认收货
					</div>
					<span class="heng-" style="left: 357px;"></span>
					<div class="shop_jinD2">
						完成
					</div>
				</div>
			</div>
		</div>
		<!--Logo&搜索栏 End-->
		<!--购物车主体-->
		<div class="shopCar_wrap">
			<div class="imgShow">
				<p class="allMyCar_font">全部商品</p>
				<div class="allMyBiens_Car">
					<div class="checked_all">
						<input type="checkbox" class="check_box" id="allChecked" value="" />
					</div>
					<div class="name">全选</div>
	                <div class="price fl">单价（元）</div>
	                <div class="quantity fl">数量</div>
	                <div class="coupon fl">优惠</div>
	                <div class="money fl">金额（元）</div>
	                <div class="operating fl">操作</div>
				</div>
				<div id="ZZZ">
					<div class="myBiens">
						<div class="biens_shoW" style="display: none;">
							<div class="checked_all checkOne">
								<input type="checkbox" class="check_box" value="" />
							</div>
							<div class="name">
								<div class="name_left">
									<a href="#" target="_blank">
										<!--<img src="img/detail/1.jpg" width="88" height="96"/>-->
									</a>
								</div>
								<div class="name_right">
									<p class="mingZ">
										<!--<a href="#" target="_blank">商品名称商品名称商品名称商品名称商品名称</a>-->
									</p>
									<!--<p class="product_gift">颜色:浅蓝色 尺码:XL 型号:连衣裙 </p>-->
								</div>
							</div>
							<div class="price price_sharp">
								<!--<p>商品价格</p>-->
							</div>
							<div class="quantity quantity_sharp">
								<span class="jian">
									<a href="javascript:;">-</a>
								</span>
								<span class="shuLiang">
									<input type="text" name="" id="shuLiang_text" value="1" />
								</span>
								<span class="jia">
									<a href="javascript:;">+</a>
								</span>
							</div>
							<div class="coupon coupon_sharp">
								无
							</div>
							<div class="money money_sharp">
								<!--<i></i>-->
							</div>
							<div class="operating operating_sharp">
								<a href="javascript:;" target="_blank">移入收藏夹</a>
								<a href="javascript:;" id="delete_myGood">删除</a>
							</div>
						</div>
						<div class="blank" style="display: none;">
							<p>您的购物车空空如也~快去扫货吧~~</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--尾部 start-->
		<div id="gx_footer">
			<div class="gx_footer_promotion">
				<dl class="gx_footer_promotion_dl">
					<dt>多</dt>
					<dd>
						<span>更多</span>
						品质齐全
					</dd>
					<dt>快</dt>
					<dd>
						<span>更快</span>
						快速配送
					</dd>
					<dt>好</dt>
					<dd>
						<span>更好</span>
						汇聚品牌
					</dd>
					<dt>省</dt>
					<dd>
						<span>更省</span>
						天天优惠
					</dd>
					<dt id="last_dt">24</dt>
					<dd id="last_dd">
						<span id="last_span">400-620-6899</span>
						24小时服务
					</dd>
				</dl>
				<div class="gx_footer_promotion_list">
					<dl>
						<dt>新手指引</dt>
						<dd><a href="#">商家入驻</a></dd>
						<dd><a href="#">合作加盟</a></dd>
						<dd><a href="#">盖网终端机</a></dd>
					</dl>
					<dl>
						<dt>购物指南</dt>
						<dd><a href="#">购物流程</a></dd>
						<dd><a href="#">查询订单</a></dd>
						<dd><a href="#">付款方式</a></dd>
					</dl>
					<dl>
						<dt>积分说明</dt>
						<dd><a href="#">商城积分</a></dd>
						<dd><a href="#">如何获取积分</a></dd>
						<dd><a href="#">如何使用积分</a></dd>
					</dl>
					<dl>
						<dt>用户服务</dt>
						<dd><a href="#">用户注册</a></dd>
						<dd><a href="#">修改密码</a></dd>
					</dl>
					<dl>
						<dt>商城服务</dt>
						<dd><a href="#">广告服务</a></dd>
					</dl>
					<div class="weiXin2">
						<img src="img/weixin2.png" width="90" height="90"/>
						<p>关注公众微信号</p>
					</div>
				</div>
			</div>
			<div class="gx_footer_link">
				<div class="gx_footer_link_main">
					<div class="Yo">
						<a href="#">app下载</a>|
						<a href="#">关于盖网</a>|
						<a href="#">帮助中心</a>|
						<a href="#">网站地图</a>|
						<a href="#">诚聘英才</a>|
						<a href="#">友情链接</a>|
						<a href="#">联系客服</a>|
						<a href="#">免责声明</a>|
						<a href="#">隐私保护</a>|
						<a href="#">站长统计</a>
						<div class="linkList">
							<div class="linkList">
								Copyright&copy;g-emall.com&nbsp;&nbsp;
								广东盖网通传媒有限公司&nbsp;&nbsp;
								增值电信业务营业许可证：
								<a>粤B2-20140364</a>
								<a href="#">粤ICP备14049968号-2</a>
								<a href="#">互联网药品信息服务资格证</a>
								<a href="#">网络文化经营许可证</a>
								<a href="#">穗公网监备案证第44070050010060号</a>	
							</div>
							<div class="linkImg">
								<a href="#"><img src="img/14284588045264.gif"/></a>
								<a href="#"><img src="img/20141126003212.png"/></a>
								<a href="#"><img src="img/14368612782081.jpg"/></a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--尾部 end-->
		<script type="text/javascript">
			loadCart();
			var cartStr = getCookie("cart");
//			console.log(cartStr);
			if(!cartStr){
				$(".blank").css({
					display: "block"
				});
			}else{
				$('.biens_shoW').css('display','block');
				var cartObj = convertCartStrToObj(cartStr);
//				console.log(cartObj);
				//遍历所有的商品生成html添加到购物车列表中去
				for(var goodID in cartObj) {
					//商品信息对象
					var good = cartObj[goodID];
					console.log(good.price)
					$('<img width="88" height="96" src="' + good.src + '">').appendTo($('.name_left a'));
					$('<a href="#" target="_blank">' + good.name + '</a>').appendTo($('.mingZ'));
					$('<p>￥' + good.price + '</p>').appendTo($('.price_sharp'));
					$('#shuLiang_text').val(good.num);
					$('<span>￥' + ( good.price * good.num ) + '</span>').appendTo($('.money_sharp'));
				}	
			};
				//封装一个加载的函数
			   function loadCart(){
					var cartStr = getCookie("cart") ? getCookie("cart") : "";
			        var cartObj = convertStrToObj(cartStr);
					//获取到购物车中所有商品的数量
					var total = 0;
					for(var id in cartObj){
						total += cartObj[id].num;
					}
					$("#shuLiang_text").val(total);
	 			}
			   //加减按钮点击事件
			   $('.jia').click(function(){
			   		var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
					var cartObj = convertCartStrToObj(cartStr);
					cartObj[goodID].num += 1;
					$('.money_sharp').find('span').text('￥' + cartObj[goodID].num * good.price )
					//将页面上显示的数量加1
					$('#shuLiang_text').val("" + cartObj[goodID].num);
					//更新页面上的小计
					//$(this).siblings('.total').html(cartObj[goodID].num * cartObj[goodID].price + "");
					//将信息放回cookie
					setCookie('cart', convertObjToCartStr(cartObj),7);
			   })
			   $('.jian').click(function(){
			   		var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
					var cartObj = convertCartStrToObj(cartStr);
					cartObj[goodID].num -= 1;
					if(cartObj[goodID].num < 0){
						cartObj[goodID].num = 0;
					}
					$('.money_sharp').find('span').text('￥' + cartObj[goodID].num * good.price )
					//将页面上显示的数量加1
					$('#shuLiang_text').val("" + cartObj[goodID].num);
					//更新页面上的小计
					//$(this).siblings('.total').html(cartObj[goodID].num * cartObj[goodID].price + "");
					//将信息放回cookie
					setCookie('cart', convertObjToCartStr(cartObj),7);
			   })
			   //数量框内的数值
			   $("#shuLiang_text").blur(function(){
			   		var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
					var cartObj = convertCartStrToObj(cartStr);
					console.log(!(/^[0-9]+$/.test($('#shuLiang_text').val())) && !(/^\s+$/.test($('#shuLiang_text').val())))
//					console.log(typeof $('#shuLiang_text').val())
					if(!(/^[0-9]+$/.test($('#shuLiang_text').val()))){
						$('#shuLiang_text').val(cartObj[goodID].num);
						return;
					}
//					else if(/^\s+$/.test($('#shuLiang_text').val())){
//						$('#shuLiang_text').val("");
//						$('.money_sharp').find('span').text('￥' + 0 )
//						return;
//					}
					else{
						cartObj[goodID].num = $("#shuLiang_text").val();
						$('.money_sharp').find('span').text('￥' + cartObj[goodID].num * good.price )
						//将页面上显示的数量变为
						$('#shuLiang_text').val("" + cartObj[goodID].num);
						//更新页面上的小计
						//$(this).siblings('.total').html(cartObj[goodID].num * cartObj[goodID].price + "");
						//将信息放回cookie
						setCookie('cart', convertObjToCartStr(cartObj),7);
					}
			   })
			   //添加删除按钮的功能
			   $('#delete_myGood').click(function(){
			   		$('.biens_shoW').css('display','none');
			   		$('.blank').css('display','block');
			   		var cartStr = $.cookie("cart") ? removeCookie("cart") : "";
			   })
			   //全选按钮设置
			   $('#allChecked').click(function(){
			   		$(".checkOne input").prop("checked", function( i, val ) {
						return !val;
					});
			   })
			   $(".checkOne input").click(function(){
			   		if(!($(".checkOne input").prop('checked'))){
			   			$('#allChecked').prop('checked',function(i,val){
			   				return false;
			   			});
			   		}
			   		$('.checkOne').each(function(){
			   			if($(this).find('input').prop('checked')){
			   				$('#allChecked').prop('checked',function(i,val){
			   					return true;
			   				});
			   			}
			   		})
			   })
			   
			   setInterval(loadCart,30)
			
					function loadCart(){
						var cartStr = getCookie("cart");
				        var cartObj = convertCartStrToObj(cartStr);
						//获取到购物车中所有商品的数量
						if(!cartStr){
							$('.head_shocar_num').text(0);
						}else{
							var total = 0;
							for(var id in cartObj){
								total += cartObj[id].num;
							}
							$('.head_shocar_num').text(total);
						}
		 			}
		</script>
		<!--主体 end-->
	</body>
</html>
